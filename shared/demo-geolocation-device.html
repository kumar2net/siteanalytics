<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site Analytics - Geolocation & Device Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .demo-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .device-info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        .info {
            color: #17a2b8;
            font-weight: bold;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üåç Site Analytics - Geolocation & Device Demo</h1>
    
    <div class="demo-section">
        <h2>üì± Device Information</h2>
        <div id="deviceInfo" class="device-info">
            <p>Loading device information...</p>
        </div>
    </div>

    <div class="demo-section">
        <h2>üìç Geolocation</h2>
        <div id="geolocationInfo" class="device-info">
            <p>Click "Get Location" to enable geolocation tracking</p>
        </div>
        <button class="button" onclick="getLocation()">Get Location</button>
        <button class="button" onclick="trackWithLocation()">Track with Location</button>
    </div>

    <div class="demo-section">
        <h2>üìä Analytics Tracking</h2>
        <p>This page automatically tracks device information. Use the buttons below to test different tracking scenarios:</p>
        
        <button class="button" onclick="trackPageView()">Track Page View</button>
        <button class="button" onclick="trackCustomEvent()">Track Custom Event</button>
        <button class="button" onclick="trackWithCustomData()">Track with Custom Data</button>
        
        <div id="trackingResults" style="margin-top: 15px;"></div>
    </div>

    <div class="demo-section">
        <h2>üîß API Endpoints</h2>
        <p>Test the new analytics endpoints:</p>
        
        <button class="button" onclick="testGeolocationAPI()">Test Geolocation API</button>
        <button class="button" onclick="testDeviceAPI()">Test Device API</button>
        <button class="button" onclick="testDeviceBreakdown()">Test Device Breakdown</button>
        
        <div id="apiResults" style="margin-top: 15px;"></div>
    </div>

    <!-- Include the analytics tracker -->
    <script src="analytics-tracker.js"></script>
    <script>
        // Initialize analytics (replace with your actual API endpoint)
        const API_ENDPOINT = 'http://localhost:8888';
        SiteAnalytics.init(API_ENDPOINT, { debug: true });

        // Display device information
        function displayDeviceInfo() {
            const userAgent = navigator.userAgent;
            const platform = navigator.platform;
            const screenInfo = {
                width: screen.width,
                height: screen.height,
                availWidth: screen.availWidth,
                availHeight: screen.availHeight,
                colorDepth: screen.colorDepth,
                pixelDepth: screen.pixelDepth
            };
            
            const deviceInfoDiv = document.getElementById('deviceInfo');
            deviceInfoDiv.innerHTML = `
                <h3>Device Details:</h3>
                <p><strong>User Agent:</strong> ${userAgent}</p>
                <p><strong>Platform:</strong> ${platform}</p>
                <p><strong>Screen Resolution:</strong> ${screenInfo.width}x${screenInfo.height}</p>
                <p><strong>Available Screen:</strong> ${screenInfo.availWidth}x${screenInfo.availHeight}</p>
                <p><strong>Color Depth:</strong> ${screenInfo.colorDepth} bits</p>
                <p><strong>Language:</strong> ${navigator.language}</p>
                <p><strong>Online:</strong> ${navigator.onLine ? 'Yes' : 'No'}</p>
                <p><strong>Cookie Enabled:</strong> ${navigator.cookieEnabled ? 'Yes' : 'No'}</p>
            `;
        }

        // Get geolocation
        function getLocation() {
            const geoDiv = document.getElementById('geolocationInfo');
            geoDiv.innerHTML = '<p>Getting location...</p>';
            
            if (!navigator.geolocation) {
                geoDiv.innerHTML = '<p class="error">Geolocation is not supported by this browser.</p>';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude, accuracy } = position.coords;
                    geoDiv.innerHTML = `
                        <h3>Location Found:</h3>
                        <p><strong>Latitude:</strong> ${latitude}</p>
                        <p><strong>Longitude:</strong> ${longitude}</p>
                        <p><strong>Accuracy:</strong> ${accuracy} meters</p>
                        <p class="success">‚úÖ Location obtained successfully!</p>
                    `;
                },
                (error) => {
                    let errorMessage = 'Unknown error occurred';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = 'User denied the request for geolocation.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = 'Location information is unavailable.';
                            break;
                        case error.TIMEOUT:
                            errorMessage = 'The request to get user location timed out.';
                            break;
                    }
                    geoDiv.innerHTML = `<p class="error">‚ùå ${errorMessage}</p>`;
                },
                {
                    enableHighAccuracy: false,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }

        // Track with location
        function trackWithLocation() {
            const resultsDiv = document.getElementById('trackingResults');
            resultsDiv.innerHTML = '<p class="info">üîÑ Tracking with geolocation...</p>';
            
            SiteAnalytics.trackWithGeolocation({
                custom_field: 'demo_with_location',
                demo_type: 'geolocation_test'
            });
            
            setTimeout(() => {
                resultsDiv.innerHTML = '<p class="success">‚úÖ Page view tracked with geolocation!</p>';
            }, 1000);
        }

        // Track page view
        function trackPageView() {
            const resultsDiv = document.getElementById('trackingResults');
            resultsDiv.innerHTML = '<p class="info">üîÑ Tracking page view...</p>';
            
            SiteAnalytics.track();
            
            setTimeout(() => {
                resultsDiv.innerHTML = '<p class="success">‚úÖ Page view tracked successfully!</p>';
            }, 1000);
        }

        // Track custom event
        function trackCustomEvent() {
            const resultsDiv = document.getElementById('trackingResults');
            resultsDiv.innerHTML = '<p class="info">üîÑ Tracking custom event...</p>';
            
            SiteAnalytics.trackEvent('demo_button_click', {
                button_name: 'custom_event_button',
                timestamp: new Date().toISOString(),
                demo_type: 'device_analytics'
            });
            
            setTimeout(() => {
                resultsDiv.innerHTML = '<p class="success">‚úÖ Custom event tracked successfully!</p>';
            }, 1000);
        }

        // Track with custom data
        function trackWithCustomData() {
            const resultsDiv = document.getElementById('trackingResults');
            resultsDiv.innerHTML = '<p class="info">üîÑ Tracking with custom data...</p>';
            
            SiteAnalytics.track({
                custom_field: 'demo_custom_data',
                demo_type: 'device_analytics',
                additional_info: {
                    page_type: 'demo',
                    user_action: 'custom_tracking'
                }
            });
            
            setTimeout(() => {
                resultsDiv.innerHTML = '<p class="success">‚úÖ Page view tracked with custom data!</p>';
            }, 1000);
        }

        // Test geolocation API
        async function testGeolocationAPI() {
            const resultsDiv = document.getElementById('apiResults');
            resultsDiv.innerHTML = '<p class="info">üîÑ Testing geolocation API...</p>';
            
            try {
                const startDate = new Date();
                startDate.setDate(startDate.getDate() - 7);
                const endDate = new Date();
                
                const response = await fetch(`${API_ENDPOINT}/api/analytics/geolocation?start_date=${startDate.toISOString()}&end_date=${endDate.toISOString()}&limit=5`);
                const data = await response.json();
                
                resultsDiv.innerHTML = `
                    <h3>Geolocation API Response:</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                    <p class="success">‚úÖ Geolocation API test completed!</p>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">‚ùå API test failed: ${error.message}</p>`;
            }
        }

        // Test device API
        async function testDeviceAPI() {
            const resultsDiv = document.getElementById('apiResults');
            resultsDiv.innerHTML = '<p class="info">üîÑ Testing device API...</p>';
            
            try {
                const startDate = new Date();
                startDate.setDate(startDate.getDate() - 7);
                const endDate = new Date();
                
                const response = await fetch(`${API_ENDPOINT}/api/analytics/devices?start_date=${startDate.toISOString()}&end_date=${endDate.toISOString()}&limit=5`);
                const data = await response.json();
                
                resultsDiv.innerHTML = `
                    <h3>Device API Response:</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                    <p class="success">‚úÖ Device API test completed!</p>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">‚ùå API test failed: ${error.message}</p>`;
            }
        }

        // Test device breakdown
        async function testDeviceBreakdown() {
            const resultsDiv = document.getElementById('apiResults');
            resultsDiv.innerHTML = '<p class="info">üîÑ Testing device breakdown API...</p>';
            
            try {
                const startDate = new Date();
                startDate.setDate(startDate.getDate() - 7);
                const endDate = new Date();
                
                const response = await fetch(`${API_ENDPOINT}/api/analytics/devices/breakdown?start_date=${startDate.toISOString()}&end_date=${endDate.toISOString()}`);
                const data = await response.json();
                
                resultsDiv.innerHTML = `
                    <h3>Device Breakdown API Response:</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                    <p class="success">‚úÖ Device breakdown API test completed!</p>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">‚ùå API test failed: ${error.message}</p>`;
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            displayDeviceInfo();
        });
    </script>
</body>
</html> 